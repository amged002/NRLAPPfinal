@*skjema for registrering av hinder med validering og kartposisjon*@
@model NRLApp.Models.ObstacleData
@{
    ViewData["Title"] = "Registrer luftfartshinder";
}
<h2 class="mb-3">@ViewData["Title"]</h2>

@*post skjema som sender inn ny registering*@
<form asp-action="DataForm" asp-controller="Obstacle" method="post" class="row g-3">
    <div asp-validation-summary="ModelOnly" class="text-danger"></div> @*feilmeldinger*@
    
@*skjemafelter som sendes inn: navn, høyde og beskrivelse av hinder*@
    <div class="col-md-6">
        <label asp-for="ObstacleName" class="form-label"></label>
        <input asp-for="ObstacleName" class="form-control" />
        <span asp-validation-for="ObstacleName" class="text-danger"></span>
    </div>

    <div class="col-md-6">
        <label asp-for="ObstacleHeight" class="form-label"></label>
        <input asp-for="ObstacleHeight" type="number" step="any" class="form-control" />
        <span asp-validation-for="ObstacleHeight" class="text-danger"></span>
    </div>

    <div class="col-12">
        <label asp-for="ObstacleDescription" class="form-label"></label>
        <textarea asp-for="ObstacleDescription" class="form-control" rows="3"></textarea>
        <span asp-validation-for="ObstacleDescription" class="text-danger"></span>
    </div>
    
@*kart, markering av posisjon til hindre*@
    <div class="col-12">
        <div id="map" style="height: 400px; border-radius: 8px;"></div>
        <small class="text-muted">Klikk på kartet for å velge posisjon.</small>
    </div>

@*kordinater fra kart (lat/lng)*@
    <input asp-for="Latitude" type="hidden" id="Latitude" />
    <input asp-for="Longitude" type="hidden" id="Longitude" />
    <div class="col-12">
        <span asp-validation-for="Latitude" class="text-danger"></span>
        <span asp-validation-for="Longitude" class="text-danger"></span>
    </div>

@*Send inn og se registrerte hindre*@    
    <div class="col-12">
        <button type="submit" class="btn btn-primary">Send inn</button>
        <a asp-controller="Obstacle" asp-action="List" class="btn btn-outline-secondary ms-2">Se registrerte</a>
    </div>
</form>

@*laster leaflet, init kart og markering ved klikk*@
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map').setView([64.0, 10.0], 5);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    let marker;
    map.on('click', function (e) {
        const lat = e.latlng.lat.toFixed(6);
        const lng = e.latlng.lng.toFixed(6);
        if (marker) marker.setLatLng(e.latlng); else marker = L.marker(e.latlng).addTo(map);
        document.getElementById('Latitude').value = lat;
        document.getElementById('Longitude').value = lng;
    });
</script>

@section Scripts{ <partial name="_ValidationScriptsPartial" /> @*klientvalidering*@} 